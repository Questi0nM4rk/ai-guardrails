# CodeRabbit Configuration
# https://docs.coderabbit.ai/reference/configuration

language: en-US

reviews:
  # Assertive = thorough, detailed feedback (matches our pedantic philosophy)
  profile: "assertive"

  # Submit "Request Changes" when actionable comments exist
  # Submit "Approved" when all comments are resolved
  request_changes_workflow: true

  # Review output
  high_level_summary: true
  poem: false
  review_status: true
  collapse_walkthrough: false

  # Auto-review disabled — trigger on-demand via /review-all
  auto_review:
    enabled: false
    drafts: false
    # Takes effect when auto_review is re-enabled
    auto_incremental_review: true

  # Stop review if PR is closed/merged
  abort_on_close: true

  # Path-specific review instructions
  path_instructions:
    # Global rules — applied to ALL files
    - path: "**/*"
      instructions: |
        - Flag code duplication: repeated logic should be extracted into shared functions or utilities
        - Enforce clean code: clear naming, single-responsibility functions, no dead code
        - Check for improper method usage: prefer standard library/framework methods over reimplementation
        - Enforce modern language usage: flag deprecated APIs, outdated idioms, or legacy patterns
    - path: "**/*.py"
      instructions: |
        - Enforce type hints on all function signatures
        - Check for proper exception handling (no bare except)
        - Verify docstrings on public functions/classes
        - Enforce modern Python: f-strings over .format(), pathlib over os.path, walrus operator where cleaner
    - path: "**/*.sh"
      instructions: |
        - Verify scripts use set -euo pipefail
        - Check for proper quoting of variables
        - Ensure portable syntax (POSIX where possible, or document bash-isms)
    - path: "**/tests/**"
      instructions: |
        - Focus on test coverage and edge cases
        - Verify meaningful assertions

  # Static analysis tools — all enabled for maximum coverage
  tools:
    # Python
    ruff:
      enabled: true
    # Shell
    shellcheck:
      enabled: true
    # Markdown
    markdownlint:
      enabled: true
    # YAML
    yamllint:
      enabled: true
    # Security — secret detection
    gitleaks:
      enabled: true
    # Security — SAST
    semgrep:
      enabled: true
    # Security — dependency vulnerabilities
    osvScanner:
      enabled: true
    # Security — IaC scanning
    checkov:
      enabled: true
    # Spell/grammar checking
    languagetool:
      enabled: true
    # GitHub Actions workflow validation
    actionlint:
      enabled: true
    # Dockerfile best practices
    hadolint:
      enabled: true

  # AI-generated additions
  finishing_touches:
    docstrings:
      enabled: true
    unit_tests:
      enabled: true

chat:
  auto_reply: true
